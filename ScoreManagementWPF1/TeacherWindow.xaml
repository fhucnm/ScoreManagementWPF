<Window x:Class="ScoreManagementWPF1.TeacherWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Quản lý điểm môn học" Height="800" Width="1200"
        WindowStartupLocation="CenterScreen">
    <DockPanel Margin="10">
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" HorizontalAlignment="Right">
            <TextBlock x:Name="WelcomeText" FontSize="20" FontWeight="Bold"
               HorizontalAlignment="Left" VerticalAlignment="Center"
               Margin="0,0,20,0" />
            <Button Content="Đăng xuất"
            Click="Logout_Click"
            Width="90" Padding="10,5"
            Background="Tomato" Foreground="White"
            HorizontalAlignment="Right" />
        </StackPanel>
        <TabControl x:Name="MainTabControl" SelectionChanged="TabControl_SelectionChanged">
            <!-- Các TabItem nằm ở đây -->


            <!-- Tab 1: Quản lý sinh viên -->
            <TabItem Header="Quản lý sinh viên">

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="140.5"/>
                        <ColumnDefinition Width="40"/>
                        <ColumnDefinition Width="78.764"/>
                        <ColumnDefinition Width="14.736"/>
                        <ColumnDefinition Width="32"/>
                        <ColumnDefinition Width="94"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Form bên trái -->
                    <StackPanel Grid.Column="0" Margin="0,0,10,0" Grid.ColumnSpan="6">
                        <TextBlock Text="(Chỉ hiển thị lớp-môn bạn được phân công)" FontStyle="Italic" FontSize="11" Foreground="Gray"/>
                        <TextBlock Text="Chọn lớp học phần:"/>
                        <ComboBox x:Name="CourseComboBox"
          DisplayMemberPath="Title"
          SelectedValuePath="CourseId"
          SelectionChanged="CourseComboBox_SelectionChanged"/>

                        <TextBlock Text="Chọn môn học trong lớp:" Margin="0,10,0,0"/>
                        <ComboBox x:Name="SubjectComboBox"
          DisplayMemberPath="Title"
          SelectedValuePath="SubjectId"/>

                        <TextBlock Text="Chọn học sinh:" Margin="0,10,0,0"/>
                        <ComboBox x:Name="StudentSelectComboBox"
          DisplayMemberPath="User.FullName"
          SelectedValuePath="StudentId"/>

                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                            <Button Content="Thêm" Click="AddStudent_Click" Width="80"/>
                            <!--<Button Content="Cập nhật" Click="UpdateStudent_Click" Width="100" Margin="10,0,0,0"/> -->
                            <Button Content="Hủy" Click="CancelEditStudent_Click" Width="80" Margin="10,0,0,0"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Bảng danh sách học sinh -->
                    <StackPanel Grid.Column="6">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBox x:Name="StudentSearchBox" Width="250" Margin="0,0,10,0"/>
                            <Button Content="Tìm kiếm" Click="SearchStudent_Click" Margin="0,0,5,0"/>

                            <!-- Chọn lớp -->
                            <TextBlock Text="Lớp học phần:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <ComboBox x:Name="cbCourseFilter"
                    DisplayMemberPath="Title"
                    SelectedValuePath="CourseId"
                    SelectionChanged="cbCourseFilter_Selection"
                    Width="150"
                    Margin="0,0,10,0"/>

                            <!-- Chọn môn -->
                            <TextBlock Text="Môn học:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <ComboBox x:Name="cbSubjectFilter"
                    DisplayMemberPath="Title"
                    SelectedValuePath="SubjectId"
                    SelectionChanged="SubjectComboBox_SelectionChanged"
                    Width="150"
                    Margin="0,0,10,0"/>
                        </StackPanel>

                        <DataGrid x:Name="StudentDataGrid" AutoGenerateColumns="False">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Mã HS" Binding="{Binding StudentId}" Width="50"/>
                                <DataGridTextColumn Header="Tên" Binding="{Binding FullName}" Width="100"/>
                                <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="150"/>
                                <DataGridTextColumn Header="Lớp học" Binding="{Binding CourseTitle}" Width="150"/>
                                <DataGridTextColumn Header="Môn" Binding="{Binding SubjectTitle}" Width="200"/>

                                <DataGridTemplateColumn Header="Hành động" Width="150">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <!--<Button Content="Sửa" Margin="5,0" Click="EditStudent_Click" Tag="{Binding}"/> -->
                                                <Button Content="Xóa" Margin="5,0" Click="DeleteStudent_Click" Tag="{Binding}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>

                    </StackPanel>
                </Grid>
            </TabItem>


            <!-- Tab 2: Quản lý điểm -->

            <TabItem Header="Quản lý điểm">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">

                        <!-- Bộ lọc -->
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Top" Margin="0,0,0,10">
                            <TextBlock Text="Lọc theo lớp học phần:" Margin="0,0,10,0" VerticalAlignment="Center"/>
                            <ComboBox x:Name="cbMarkCourse" Width="200" Margin="0,0,20,0"
                          DisplayMemberPath="Title" SelectedValuePath="CourseId"
                          SelectionChanged="cbCourseGrade_SelectionChanged"/>

                            <TextBlock Text="Lọc theo môn học:" Margin="0,0,10,0" VerticalAlignment="Center"/>
                            <ComboBox x:Name="cbMarkSubject" Width="200"
                          DisplayMemberPath="Title" SelectedValuePath="SubjectId"
                          SelectionChanged="cbSubjectGrade_SelectionChanged"/>

                            <Button Content="📥 Import điểm từ file" Click="ImportMarksFromFile_Click" Margin="5" />

                        </StackPanel>

                        <!-- Tìm kiếm -->
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Top" Margin="0,0,0,10">
                            <TextBlock Text="Tìm sinh viên:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <TextBox x:Name="txtSearchMark" Width="200" Margin="0,0,10,0"/>
                            <Button Content="Tìm kiếm" Click="SearchMark_Click" Margin="0,0,10,0"/>
                            <Button Content="Xuất theo môn" Click="ExportBySubject_Click" Margin="0,0,80,0"/>

                            <TextBlock Text="Chọn sinh viên:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <ComboBox x:Name="cbStudentGrade"
                                Width="200"
                                Margin="0,0,10,0"
                                DisplayMemberPath="FullName"
                                SelectedValuePath="StudentId"/>

                            <Button Content="Xuất theo sinh viên" Click="ExportByStudent_Click" Margin="0,0,100,0"/>
                            <Button Content="Lưu điểm" Click="SaveEditedMarks_Click" />

                        </StackPanel>

                        <!-- Bảng điểm -->
                        <DataGrid x:Name="dgMarks"
                            AutoGenerateColumns="False"
                            CanUserAddRows="False"
                            CanUserDeleteRows="False"
                            IsReadOnly="False"
                            CellEditEnding="dgMarks_CellEditEnding"
                            HeadersVisibility="Column"
                            Margin="0,0,0,10"
                            RowHeaderWidth="0"
                            SelectionUnit="FullRow"
                            SelectionMode="Single"
                            GridLinesVisibility="All">
                        </DataGrid>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>





        </TabControl>
    </DockPanel>

</Window>